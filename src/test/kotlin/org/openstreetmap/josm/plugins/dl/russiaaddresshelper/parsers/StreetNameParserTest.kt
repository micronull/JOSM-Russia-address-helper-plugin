package org.openstreetmap.josm.plugins.dl.russiaaddresshelper.parsers

import org.junit.Test
import org.junit.jupiter.api.Assertions.*
import org.junit.jupiter.params.provider.Arguments
import org.openstreetmap.josm.data.osm.OsmPrimitive
import org.openstreetmap.josm.plugins.dl.russiaaddresshelper.api.ParsingFlags
import org.openstreetmap.josm.plugins.dl.russiaaddresshelper.models.StreetTypes

internal class StreetNameParserTest {
    private val streetTypes: StreetTypes = StreetTypes.byYml("/references/street_types.yml")

    @Test
    fun parseTest() {
        val testData = mapOf(
            "Михалевская улица" to "Калужская область, г. Калуга, Михалевская ул., д. 39",
            "1-я Михалевская улица" to "Калужская область, г. Калуга, Михалевская 1-я ул., д. 39",
            "2-ая Михалевская улица" to "Калужская область, г. Калуга, 2-я Михалёвская ул., д. 39",
            "улица Шуры Екимовой" to "обл. Свердловская, г. Дегтярск, ул. Шуры Екимовой, дом 49",
            //в текущей регулярке нет возможности понять закончилась ли улица. Может делать отсечку по признаку дома?
            // "Лесная улица" to "Республика Башкортостан, Калтасинский район, с. Краснохолмский ул. Лесная д. 24",
            "улица Николая Островского" to "Калужская область, г. Калуга, ул. Н. Островского, д. 34, часть 2",
            "улица Гизатуллина" to "Республика Башкортостан, р-н. Калтасинский, с. Краснохолмский, ул. имени Гизатуллина, д. 10",
            "2-й переулок Победы" to "Калужская область, р-н Сухиничский, г. Сухиничи, пер. Победы 2-й, д. 19",
            "1-ый Садовый переулок" to "Калужская область, р-н Сухиничский, г. Сухиничи, пер. Садовый 1-й, д. 4",
            "2-й Садовый переулок" to "Калужская обл., р-н Сухиничский, г. Сухиничи,  2-й пер. Садовый, дом 22",
            "2-й переулок Ломоносова" to "Калужская область, р-н Сухиничский, г. Сухиничи, 2-й пер. Ломоносова , д. 3а",
            "2-я улица Буденного" to "Калужская область, р-н Сухиничский, г. Сухиничи, ул. 2-я Буденного, стр. 2",
            "1-я Смоленская улица" to "Калужская обл, р-н Сухиничский, г.Сухиничи, ул.Смоленская 1-я, дом 2",
            "1-й Ленинский переулок" to "Калужская обл., р-н Думиничский, п. Думиничи, 1-й Ленинский пер., д. 21",
            "1-я улица Буденного" to "Калужская область, р-н Сухиничский, г. Сухиничи, 1-я ул. Буденного, стр. 2",
            "Киёвский проезд" to "Российская Федерация, Калужская обл., г.о. \"Город Калуга\", г. Калуга, пр-д Киёвский, д. 45б",
            "проспект Маркса" to "Калужская область, г.Обнинск, пр-кт Маркса, д.30б",
            "улица Марии Ульяновой" to "Российская Федерация, Брянская область, городской округ город Брянск, г. Брянск, ул. Марии Ульяновой, земельный участок 12",
            "улица Марии Ульяновой" to "Российская Федерация, Брянская область, городской округ город Брянск, г. Брянск, Марии Ульяновой ул, земельный участок 12",
            "2-й переулок Покрова" to "Калужская обл., г. Калуга, пер. Покрова 2-й, дом 4",
            //"2-й переулок Покрова" to "Калужская обл., г. Калуга, пер. Покрова  2-й, дом 4", не парсится неясно как чинить
            "Серебряный бульвар" to "Калужская обл., г. Калуга, Серебряный бульвар, дом 4",
            "1-й Заводской тупик" to "Калужская обл., п. Детчино, 1-ый Заводской тупик, дом 4",
            "1-й Заводской тупик" to "Калужская обл., п. Детчино, туп. 1-ый Заводской, дом 4",
            "Серебряный бульвар" to "Калужская обл., г. Калуга, улица Серебряный бульвар, дом 4",
            "1-й Заводской тупик" to "Калужская обл., г. Калуга, ул. 1-й Заводской тупик, дом 4",
            "Промышленный проезд" to "Российская Федерация, Калужская область, р-н Боровский, д Денисово, проезд Промышленный, вл 2",
            "Шоссейная улица" to "Калужская обл., р-н Боровский, г. Балабаново, ул. Шоссейная, д. 9",
            "Проездная улица" to "Калужская обл., р-н Боровский, г. Балабаново, ул. Проездная, д. 9",
            "Переулочная улица" to "Калужская обл., р-н Боровский, г. Балабаново, ул. Переулочная, д. 9",
            "Тупиковая улица" to "Калужская обл., р-н Боровский, г. Балабаново, ул. Тупиковая, д. 9",
            "Тупиковая улица" to "Калужская обл., р-н Боровский, г. Балабаново, Тупиковая ул., д. 9",
            "Центральная аллея" to "Российская Федерация, Калужская область, Ферзиковский муниципальный район, с.п. \"Село Грабцево\", с. Воскресенское, ул. Центральная аллея, д. 5",
            "Центральная аллея" to "Российская Федерация, Калужская область, Ферзиковский муниципальный район, с.п. \"Село Грабцево\", с. Воскресенское, Центральная аллея, д. 5",
            "Центральная аллея" to "Российская Федерация, Калужская область, Ферзиковский муниципальный район, с.п. \"Село Грабцево\", с. Воскресенское, аллея Центральная, д. 5",
            "улица 8 Марта" to "Калужская область, р-н Износковский, с. Износки, ул. 8-ое Марта, д. 10",
            "1-я Рябиновая улица" to "Калужская обл., р-н Малоярославецкий, с. Маклино, ул. 1-я Рябиновая, уч. № 5",
            "1-я Рябиновая улица" to "Российская Федерация, Калужская область, р-н Малоярославецкий, с. Маклино, ул. 1-ая Рябиновая, дом 11"

        )


        testData.forEach { osmStreet, egrnStreet ->
            assertEquals(
                osmStreet,
                ParsedStreet.identify(egrnStreet, streetTypes, testData.keys.map { Pair(it, Pair(it, listOf<OsmPrimitive>())) }.toMap()).name
            )
        }

        assertEquals("улица Пупкина",
            ParsedStreet.identify("Москва сити, улица Васимира Пупкина", streetTypes, mapOf("улица Васимира Пупкина" to Pair("улица Пупкина", listOf<OsmPrimitive>()))).name)

        val parsedNumeredStreet = ParsedStreet.identify("Москва сити, проезд 2й Родниковый, 35", streetTypes, mapOf("2-й Родниковый проезд" to Pair("2-й Родниковый проезд", listOf<OsmPrimitive>())))
        assertEquals("2-й Родниковый проезд", parsedNumeredStreet.name)
        assertFalse(parsedNumeredStreet.flags.contains(ParsingFlags.STREET_NAME_FUZZY_MATCH))

    }


    companion object {
        @JvmStatic
        fun addresses() = listOf(
            Arguments.of("Российская Федерация, Калужская область, р-н Малоярославецкий, с. Маклино, ул. 1-ая Рябиновая, дом 11",  "1-я Рябиновая улица"))
    }
}